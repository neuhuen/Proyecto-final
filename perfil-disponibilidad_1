<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Juan's profile</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

<!-- Navigation Bar -->
<nav class="navbar navbar-expand-lg bg-body-tertiary">
  <div class="container-fluid">
    <a class="navbar-brand" href="/Proyecto-final/index.html">Freelance Hub</a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
            data-bs-target="#navbarSupportedContent">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">

      <ul class="navbar-nav me-auto mb-2 mb-lg-0">

        <li class="nav-item">
          <a class="nav-link active" href="/Proyecto-final/perfil.html">Perfil</a>
        </li>

        <li class="nav-item">
          <a class="nav-link active" href="/Proyecto-final/explorar.html">Explorar</a>
        </li>

      </ul>

      <form class="d-flex">
        <input class="form-control me-2" type="search" placeholder="Search">
        <img src="https://imgs.search.brave.com/0I-0fDSJRKyb-cA4A71jvUiGFZfnb8FsVHmCCZO6tOE/rs:fit:860:0:0:0/g:ce/aHR0cHM6Ly9kZWZp/bmljaW9uLmRlL3dw/LWNvbnRlbnQvdXBs/b2Fkcy8yMDE5LzA3/L3BlcmZpbC1kZS11/c3VhcmlvLnBuZw"
             class="rounded-circle img-thumbnail" width="40">
      </form>

    </div>
  </div>
</nav>
<!-- Navigation Bar -->

<!-- Header -->
<div class="card p-3 mt-2">
  <div class="d-flex align-items-center">

    <div class="me-3">
      <img src="https://imgs.search.brave.com/0I-0fDSJRKyb-cA4A71jvUiGFZfnb8FsVHmCCZO6tOE/rs:fit:860:0:0:0/g:ce/aHR0cHM6Ly9kZWZp/bmljaW9uLmRlL3dw/LWNvbnRlbnQvdXBs/b2Fkcy8yMDE5LzA3/L3BlcmZpbC1kZS11/c3VhcmlvLnBuZw"
           class="rounded-circle" style="width: 80px; height: 80px; object-fit: cover;">
    </div>

    <div class="flex-grow-1">
      <h5 class="mb-1">Elena Ramirez</h5>
      <p class="text-muted mb-1">Diseñadora UX/UI con más de 5 años de experiencia</p>

      <div class="d-flex align-items-center text-muted">
        <i class="bi bi-geo-alt-fill me-1"></i>
        <span>Madrid, España</span>
        <span class="mx-2">|</span>
        <i class="bi bi-star-fill text-warning me-1"></i>
        <span>4.9 (125 reseñas)</span>
      </div>
    </div>

  </div>
</div>
<!-- Header -->

<!-- Main -->
<div class="container mt-4">

  <ul class="nav nav-tabs mb-4">
    <li class="nav-item"><a class="nav-link" href="/Proyecto-final/perfil.html_1">Acerca de</a></li>
    <li class="nav-item"><a class="nav-link" href="/Proyecto-final/perfil-portafolio.html_1">Portafolio</a></li>
    <li class="nav-item"><a class="nav-link" href="/Proyecto-final/perfil-reseñas.html_1">Reseñas</a></li>
    <li class="nav-item"><a class="nav-link active" href="/Proyecto-final/perfil-disponibilidad.html_1">Disponibilidad</a></li>
  </ul>

  <div class="container d-flex justify-content-center py-4">
    <div class="card w-100 shadow rounded-4 d-flex flex-column" style="max-width:900px;">

      <div class="card-header d-flex align-items-center">
        <h5 class="mb-0">Chat</h5>
      </div>

      <!-- Mensajes -->
      <div id="messages" class="flex-grow-1 overflow-auto p-3"></div>

      <!-- Input -->
      <div class="card-body border-top">
        <div class="row g-2 align-items-end">
          <div class="col-12 col-md-9">
            <textarea id="inputMsg" class="form-control" rows="2"
              placeholder="Escribe un mensaje..."></textarea>
          </div>
          <div class="col-12 col-md-3 d-grid">
            <button id="sendBtn" class="btn btn-primary">Enviar</button>
          </div>
        </div>
      </div>

    </div>
  </div>
  <!-- Chat -->

</div>
<!-- Main -->


<!-- JavaScript del chat -->
<script>
const messagesEl = document.getElementById('messages');
const inputEl = document.getElementById('inputMsg');
const sendBtn = document.getElementById('sendBtn');
const clearBtn = document.getElementById('clearBtn');

let messages = [];

function timeNow() {
  const d = new Date();
  return d.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
}

function render() {
  messagesEl.innerHTML = '';

  for (const m of messages) {
    const row = document.createElement('div');
    row.className = "d-flex mb-2 " + (m.from === 'me' ? "justify-content-end" : "justify-content-start");

    const bubble = document.createElement('div');
    bubble.className =
      (m.from === 'me'
        ? "bg-primary text-white"
        : "bg-secondary-subtle text-dark"
      ) +
      " p-2 px-3 rounded-4 shadow-sm";
    bubble.style.maxWidth = "75%";

    bubble.innerHTML = `
      <div>${escapeHtml(m.text).replace(/\n/g,'<br>')}</div>
      <div class="small opacity-75 mt-1 text-end">
        ${m.from === 'me' ? 'Tú' : 'Juan Pérez'} • ${m.time}
      </div>
    `;

    row.appendChild(bubble);
    messagesEl.appendChild(row);
  }

  messagesEl.scrollTop = messagesEl.scrollHeight;
}

function sendMessage(text) {
  if (!text.trim()) return;

  messages.push({
    from: 'me',
    text: text.trim(),
    time: timeNow()
  });

  render();
  inputEl.value = '';
  inputEl.focus();
}

sendBtn.addEventListener('click', () => sendMessage(inputEl.value));

inputEl.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendMessage(inputEl.value);
  }
});

clearBtn?.addEventListener('click', () => {
  if (!confirm('¿Borrar todos los mensajes?')) return;
  messages = [];
  render();
});

function escapeHtml(unsafe) {
  return unsafe
    .replaceAll('&', '&amp;')
    .replaceAll('<', '&lt;')
    .replaceAll('>', '&gt;')
    .replaceAll('"', '&quot;')
    .replaceAll("'", '&#039;');
}

/* -----------------------------------------
   MENSAJE INICIAL DE PRESENTACIÓN (JUAN)
   ----------------------------------------- */
messages.push({
  from: 'other',
  text: 'Hola, soy Juan Pérez, desarrollador web especializado en HTML, CSS y JavaScript. Creo sitios rápidos, modernos y totalmente optimizados para cualquier dispositivo. ¿En qué puedo ayudarte hoy?',
  time: timeNow()
});

render();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
